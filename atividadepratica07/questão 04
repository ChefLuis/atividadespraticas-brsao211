import tkinter as tk
from tkinter import messagebox, scrolledtext, filedialog
import json
import os

# ---------------- FUNÇÕES ----------------

def salvar_json():
    nome = entry_nome.get().strip()
    idade = entry_idade.get().strip()
    cidade = entry_cidade.get().strip()

    if not nome or not idade or not cidade:
        messagebox.showwarning("Aviso", "Preencha todos os campos!")
        return

    try:
        idade_int = int(idade)
    except ValueError:
        messagebox.showwarning("Aviso", "Idade deve ser um número!")
        return

    dados = {
        "nome": nome,
        "idade": idade_int,
        "cidade": cidade
    }

    arquivo = filedialog.asksaveasfilename(defaultextension=".json",
                                           filetypes=[("Arquivos JSON", "*.json")],
                                           title="Salvar arquivo JSON")
    if not arquivo:
        return

    try:
        if os.path.exists(arquivo):
            # Se existir, ler e adicionar ao dicionário existente
            with open(arquivo, "r", encoding="utf-8") as f:
                conteudo = json.load(f)
            if isinstance(conteudo, list):
                conteudo.append(dados)
            else:
                conteudo = [conteudo, dados]
        else:
            conteudo = [dados]

        with open(arquivo, "w", encoding="utf-8") as f:
            json.dump(conteudo, f, indent=4, ensure_ascii=False)

        messagebox.showinfo("Sucesso", f"Dados salvos em {arquivo}")
    except Exception as e:
        messagebox.showerror("Erro", f"Falha ao salvar arquivo: {e}")

def ler_json():
    arquivo = filedialog.askopenfilename(filetypes=[("Arquivos JSON", "*.json")],
                                         title="Abrir arquivo JSON")
    if not arquivo:
        return

    try:
        with open(arquivo, "r", encoding="utf-8") as f:
            conteudo = json.load(f)

        text_area.config(state=tk.NORMAL)
        text_area.delete("1.0", tk.END)

        if isinstance(conteudo, list):
            for item in conteudo:
                text_area.insert(tk.END, f"Nome: {item.get('nome')}\n")
                text_area.insert(tk.END, f"Idade: {item.get('idade')}\n")
                text_area.insert(tk.END, f"Cidade: {item.get('cidade')}\n")
                text_area.insert(tk.END, "-"*30 + "\n")
        else:
            text_area.insert(tk.END, f"Nome: {conteudo.get('nome')}\n")
            text_area.insert(tk.END, f"Idade: {conteudo.get('idade')}\n")
            text_area.insert(tk.END, f"Cidade: {conteudo.get('cidade')}\n")

        text_area.config(state=tk.DISABLED)

    except Exception as e:
        messagebox.showerror("Erro", f"Falha ao ler arquivo: {e}")

# ---------------- INTERFACE ----------------

root = tk.Tk()
root.title("Leitura e Escrita de JSON")
root.geometry("500x500")

# Entradas
frame_inputs = tk.Frame(root)
frame_inputs.pack(pady=10)

tk.Label(frame_inputs, text="Nome:").grid(row=0, column=0, sticky="e")
entry_nome = tk.Entry(frame_inputs, width=30)
entry_nome.grid(row=0, column=1, padx=5)

tk.Label(frame_inputs, text="Idade:").grid(row=1, column=0, sticky="e")
entry_idade = tk.Entry(frame_inputs, width=30)
entry_idade.grid(row=1, column=1, padx=5)

tk.Label(frame_inputs, text="Cidade:").grid(row=2, column=0, sticky="e")
entry_cidade = tk.Entry(frame_inputs, width=30)
entry_cidade.grid(row=2, column=1, padx=5)

# Botões
frame_btns = tk.Frame(root)
frame_btns.pack(pady=10)

tk.Button(frame_btns, text="Salvar JSON", command=salvar_json, width=15, bg="#4CAF50", fg="white").pack(side=tk.LEFT, padx=5)
tk.Button(frame_btns, text="Ler JSON", command=ler_json, width=15, bg="#2196F3", fg="white").pack(side=tk.LEFT, padx=5)

# Área de texto para exibição
text_area = scrolledtext.ScrolledText(root, width=60, height=20, state=tk.DISABLED)
text_area.pack(pady=10)

root.mainloop()
